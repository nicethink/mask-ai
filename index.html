<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆìŠ¤í¬ AI ì§„ë‹¨ ëª¨ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f0f2f5; margin: 0; padding: 20px; }
        #webcam-container { width: 100%; max-width: 400px; margin: 0 auto 20px; border-radius: 15px; overflow: hidden; transform: rotateY(180deg); }
        canvas { width: 100% !important; }
        .result-box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .status-text { font-size: 1.5rem; font-weight: bold; color: #007bff; margin-bottom: 10px; }
        .debug-info { background: #333; color: #00ff00; padding: 10px; border-radius: 8px; font-family: monospace; text-align: left; font-size: 0.9rem; }
        button { width: 100%; max-width: 400px; padding: 15px; font-size: 1.1rem; background: #007bff; color: white; border: none; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>AI ì¸ì‹ ìƒíƒœ í™•ì¸ì¤‘</h2>
    <div id="webcam-container"></div>

    <div class="result-box">
        <div id="status" class="status-text">ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”</div>
        <p>ğŸ‘‡ AIê°€ ì§€ê¸ˆ ì½ê³  ìˆëŠ” ì´ë¦„ê³¼ í™•ë¥ ì…ë‹ˆë‹¤ ğŸ‘‡</p>
        <div id="debug" class="debug-info">ê²°ê³¼ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <button onclick="init()">AI íƒì§€ ì‹œì‘</button>

<script>
    // ğŸ”— ë³¸ì¸ì˜ ëª¨ë¸ URLë¡œ ê¼­ ë°”ê¿”ì£¼ì„¸ìš”!
    const URL = "https://teachablemachine.withgoogle.com/models/ya17qFlog/";

    let model, webcam, lastStatus = "";

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'ko-KR';
        window.speechSynthesis.speak(msg);
    }

    async function init() {
        document.getElementById("status").innerText = "ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
        model = await tmImage.load(URL + "model.json", URL + "metadata.json");
        
        webcam = new tmImage.Webcam(400, 400, true);
        await webcam.setup({ facingMode: "user" });
        await webcam.play();
        
        document.getElementById("webcam-container").appendChild(webcam.canvas);
        window.requestAnimationFrame(loop);
    }

    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }

    async function predict() {
        const prediction = await model.predict(webcam.canvas);
        let debugText = "";
        let topClass = "";
        let topProb = 0;

        for (let i = 0; i < prediction.length; i++) {
            const prob = (prediction[i].probability * 100).toFixed(0);
            debugText += `${prediction[i].className}: ${prob}%<br>`;
            
            if (prediction[i].probability > topProb) {
                topProb = prediction[i].probability;
                topClass = prediction[i].className;
            }
        }
        document.getElementById("debug").innerHTML = debugText;

        // --- ìˆ˜ì •í•´ì•¼ í•  í•µì‹¬ êµ¬ê°„ ---
        if (topProb > 0.8) {
            // ë§ˆìŠ¤í¬ë¥¼ ì¼ì„ ë•Œ ëœ¨ëŠ” 'ì´ë¦„'ì´ ì•„ë˜ ""ì•ˆì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
            // ë§Œì•½ ë¡œê·¸ì— 'Class 1'ì´ ëœ¨ë©´ "Class 1"ì´ë¼ê³  ì ìœ¼ì„¸ìš”.
            if (topClass.includes("Mask") || topClass.includes("ë§ˆìŠ¤í¬") || topClass.includes("Class 1")) {
                if (lastStatus !== "on") {
                    document.getElementById("status").innerText = "âœ… ë§ˆìŠ¤í¬ ì°©ìš©ë¨";
                    speak("í™˜ì˜í•©ë‹ˆë‹¤");
                    lastStatus = "on";
                }
            } else {
                if (lastStatus !== "off") {
                    document.getElementById("status").innerText = "âŒ ë§ˆìŠ¤í¬ ì•ˆì”€";
                    speak("ë§ˆìŠ¤í¬ë¥¼ ì“°ê³  ì…ì¥í•´ ì£¼ì„¸ìš”");
                    lastStatus = "off";
                }
            }
        }
    }
</script>
</body>
</html>
